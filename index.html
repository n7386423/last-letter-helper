import javax.swing.*;
import javax.swing.text.DefaultCaret;
import java.awt.*;
import java.awt.event.*;
import java.io.*;
import java.nio.charset.StandardCharsets;
import java.util.*;
import java.util.List;

public class LastLetterTrapHelper {
    private static final List<String> TRAP_ENDINGS = Arrays.asList("x", "q", "z", "j", "v");
    private static final List<String> WORDS = new ArrayList<>();

    private JFrame frame;
    private JTextField entry;
    private JTextArea output;

    public static void main(String[] args) {
        loadWords("words.txt");
        SwingUtilities.invokeLater(() -> new LastLetterTrapHelper().createAndShowGUI());
    }

    private static void loadWords(String filename) {
        try (BufferedReader br = new BufferedReader(new InputStreamReader(new FileInputStream(filename), StandardCharsets.UTF_8))) {
            String line;
            while ((line = br.readLine()) != null) {
                line = line.trim();
                if (!line.isEmpty()) {
                    WORDS.add(line);
                }
            }
        } catch (IOException e) {
            JOptionPane.showMessageDialog(null, "Error loading words file: " + e.getMessage(), "Error", JOptionPane.ERROR_MESSAGE);
            System.exit(1);
        }
    }

    private int scoreWord(String word) {
        int score = 0;
        String last = word.substring(word.length() - 1).toLowerCase();
        int length = word.length();

        if (TRAP_ENDINGS.contains(last)) {
            score += 100;
        }
        if ("q".equals(last)) {
            score += 50;
        }
        if (length >= 5 && length <= 10) {
            score += 40;
        } else {
            score -= Math.abs(length - 7) * 3;
        }
        return score;
    }

    private void search() {
        String prefix = entry.getText().trim().toLowerCase();
        output.setText("");

        if (prefix.isEmpty()) {
            return;
        }

        List<String> matches = new ArrayList<>();
        for (String w : WORDS) {
            if (w.toLowerCase().startsWith(prefix)) {
                matches.add(w);
            }
        }

        if (matches.isEmpty()) {
            output.append("No valid words.");
            return;
        }

        matches.sort((a, b) -> Integer.compare(scoreWord(b), scoreWord(a)));

        output.append("BEST FAST TRAP:\n");
        output.append(matches.get(0) + "\n\n");

        output.append("Other strong options:\n");
        int limit = Math.min(15, matches.size());
        for (int i = 1; i < limit; i++) {
            output.append(matches.get(i) + "\n");
        }
    }

    private void createAndShowGUI() {
        frame = new JFrame("Last Letter Trap Helper");
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        frame.setAlwaysOnTop(true);
        frame.setLayout(new BorderLayout());

        entry = new JTextField();
        entry.setFont(new Font("Consolas", Font.PLAIN, 18));
        entry.setColumns(22);
        entry.addActionListener(e -> search());

        JButton btn = new JButton("Search");
        btn.setFont(new Font("Consolas", Font.PLAIN, 14));
        btn.addActionListener(e -> search());

        output = new JTextArea(16, 38);
        output.setFont(new Font("Consolas", Font.PLAIN, 16));
        output.setEditable(false);
        output.setLineWrap(true);
        output.setWrapStyleWord(true);

        // Auto-scroll to top on new text
        DefaultCaret caret = (DefaultCaret) output.getCaret();
        caret.setUpdatePolicy(DefaultCaret.NEVER_UPDATE);

        JPanel topPanel = new JPanel();
        topPanel.setLayout(new FlowLayout(FlowLayout.CENTER, 10, 8));
        topPanel.add(entry);
        topPanel.add(btn);

        JScrollPane scrollPane = new JScrollPane(output);
        scrollPane.setBorder(BorderFactory.createEmptyBorder(8, 10, 8, 10));

        frame.add(topPanel, BorderLayout.NORTH);
        frame.add(scrollPane, BorderLayout.CENTER);

        frame.pack();
        frame.setLocationRelativeTo(null);
        frame.setVisible(true);
    }
}
